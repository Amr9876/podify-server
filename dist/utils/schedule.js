"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const audio_1 = __importDefault(require("../models/audio"));
const autoGeneratedPlaylist_1 = __importDefault(require("../models/autoGeneratedPlaylist"));
const node_cron_1 = __importDefault(require("node-cron"));
const generatedPlaylist = async () => {
    const result = await audio_1.default.aggregate([
        { $sort: { likes: -1 } },
        {
            $sample: { size: 20 },
        },
        {
            $group: {
                _id: "$category",
                audios: { $push: "$$ROOT._id" },
            },
        },
    ]);
    result.map(async (item) => {
        await autoGeneratedPlaylist_1.default.updateOne({ title: item._id }, { $set: { items: item.audios } }, { upsert: true });
    });
};
node_cron_1.default.schedule("0 0 * * *", async () => {
    await generatedPlaylist();
});
